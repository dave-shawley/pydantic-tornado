
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Dave Shawley">
      
      
      
        <link rel="prev" href="../0002-generate-documentation-using-mkdocs/">
      
      
        <link rel="next" href="../../todo/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>Rely on Python type annotations - Pydantic Tornado</title>
      
    
    

      <link rel="stylesheet" href="../../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
<link rel="stylesheet" href="../../stylesheets/adr.css">

    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rely-on-python-type-annotations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Pydantic Tornado" class="md-header__button md-logo" aria-label="Pydantic Tornado" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydantic Tornado
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Rely on Python type annotations
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/dave-shawley/pydantic-tornado" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    dave-shawley/pydantic-tornado
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Pydantic-tornado

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../users-guide/examples/" class="md-tabs__link">
          
  
    
  
  User's Guide

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../reference/" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Explanation

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../todo/" class="md-tabs__link">
        
  
    
  
  TODO

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Pydantic Tornado" class="md-nav__button md-logo" aria-label="Pydantic Tornado" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Pydantic Tornado
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dave-shawley/pydantic-tornado" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    dave-shawley/pydantic-tornado
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pydantic-tornado
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User's Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User's Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../users-guide/examples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../users-guide/writing-handlers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Writing handlers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../users-guide/injections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Injecting information
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../reference/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming interface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Explanation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Decision Records
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Decision Records
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0001-record-architecture-decisions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Record architecture decisions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../0002-generate-documentation-using-mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Generate documentation using mkdocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Rely on Python type annotations
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Rely on Python type annotations
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      Decision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-functions-for-request-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Use functions for request handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-state-from-the-handler-using-annotated-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Inject "state" from the handler using annotated parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hide-de-serialization-details" class="md-nav__link">
    <span class="md-ellipsis">
      Hide (de-)serialization details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#let-pydantic-handle-semantic-details" class="md-nav__link">
    <span class="md-ellipsis">
      Let pydantic handle semantic details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    <span class="md-ellipsis">
      Consequences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rejected-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected alternatives
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rejected alternatives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parsing-docstrings" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing docstrings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tying-an-openapi-specification-to-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Tying an OpenAPI specification to endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../todo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TODO
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#context" class="md-nav__link">
    <span class="md-ellipsis">
      Context
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decision" class="md-nav__link">
    <span class="md-ellipsis">
      Decision
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decision">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-functions-for-request-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Use functions for request handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inject-state-from-the-handler-using-annotated-parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Inject "state" from the handler using annotated parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hide-de-serialization-details" class="md-nav__link">
    <span class="md-ellipsis">
      Hide (de-)serialization details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#let-pydantic-handle-semantic-details" class="md-nav__link">
    <span class="md-ellipsis">
      Let pydantic handle semantic details
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consequences" class="md-nav__link">
    <span class="md-ellipsis">
      Consequences
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rejected-alternatives" class="md-nav__link">
    <span class="md-ellipsis">
      Rejected alternatives
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rejected alternatives">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parsing-docstrings" class="md-nav__link">
    <span class="md-ellipsis">
      Parsing docstrings
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tying-an-openapi-specification-to-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Tying an OpenAPI specification to endpoints
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  





<dl class="adr_header">
    <dt>Author<span class="colon">:</span></dt>
    <dd>Dave Shawley</dd>

    <dt>Created<span class="colon">:</span></dt>
    <dd>2024-03-03</dd>

    <dt>Status<span class="colon">:</span></dt>
    <dd><span class="c-pill c-pill-accepted">Accepted</span></dd>

    

    

    

</dl>






<h1 id="rely-on-python-type-annotations">Rely on Python type annotations<a class="headerlink" href="#rely-on-python-type-annotations" title="Permanent link">&para;</a></h1>
<h2 id="context">Context<a class="headerlink" href="#context" title="Permanent link">&para;</a></h2>
<p>Type annotations are becoming increasingly popular in the Python community. The <a href="https://fastapi.tiangolo.com/">FastAPI</a> framework embraced using
annotations to describe how request information is deserialized. It also relied on <a href="https://docs.pydantic.dev/">Pydantic</a> to handle the
deserialization of request data as well as the serialization of response data. I rally appreciated this after a few
years writing HTTP APIs in <a href="https://www.tornadoweb.org/">tornado</a>. The need for serialization helpers becomes obvious pretty quickly and led me
to create the <a href="https://sprocketsmixinsmedia-type.readthedocs.io/">sprockets.mixins.mediatype</a> library that implements proactive content negotiation. Unfortunately the
mediatype library implements both content negotiation via [accept] &amp; [content-type] headers and the serialization of
representations. It would be nice to decouple these aspects and make "typed" request handlers a reality in the process.</p>
<h2 id="decision">Decision<a class="headerlink" href="#decision" title="Permanent link">&para;</a></h2>
<p>We can use type annotations to handle a number of different cross-cutting aspects.</p>
<h3 id="use-functions-for-request-handling">Use functions for request handling<a class="headerlink" href="#use-functions-for-request-handling" title="Permanent link">&para;</a></h3>
<p>Moving the request handling logic out of <code>tornado.web.RequestHandler.get()</code> and its relatives and into freestanding
functions puts you in control of the request and response data types. The framework can look at your annotations and
"do the right thing" when it comes to making sure that your code is getting what it expects.</p>
<h3 id="inject-state-from-the-handler-using-annotated-parameters">Inject "state" from the handler using annotated parameters<a class="headerlink" href="#inject-state-from-the-handler-using-annotated-parameters" title="Permanent link">&para;</a></h3>
<p>Tornado <code>RequestHandler</code>s and <code>Application</code>s have some state and functionality that request handling logic needs.
Instead of creating new interfaces for adding headers or setting specific response codes, I decided to use the interfaces
that already exist. You simply add a parameter annotated as a <code>tornado.web.RequestHandler</code> to gain access to the
methods on the request handler class. Similarly, a parameter annotated with <code>tornado.web.Application</code> will receive
the application instance.</p>
<h3 id="hide-de-serialization-details">Hide (de-)serialization details<a class="headerlink" href="#hide-de-serialization-details" title="Permanent link">&para;</a></h3>
<p>I'm going to take a similar approach to the one that I took with <a href="https://sprocketsmixinsmedia-type.readthedocs.io/">sprockets.mixins.mediatype</a> when it comes to
the low-level serialization and deserialization. In fact, I might use the library for its content handlers alone.
I want this library to handle deserializing the incoming request based on the <code>content-type</code> and serialize the
response as well. The difference is that I want to take advantage of <a href="https://docs.pydantic.dev/">pydantic</a> for values that are not "basic"
(eg, <code>list</code>, <code>dict</code>, <code>str</code>, <code>int</code>, <code>float</code>). I also want to use it for its constrained type management.</p>
<h3 id="let-pydantic-handle-semantic-details">Let pydantic handle semantic details<a class="headerlink" href="#let-pydantic-handle-semantic-details" title="Permanent link">&para;</a></h3>
<p>Relying on <a href="https://docs.pydantic.dev/">pydantic</a> for deserializing request bodies and serializing responses places the semantic interpretation
of content outside the content-type management. <a href="https://docs.pydantic.dev/">Pydantic</a> takes care of knowing that the <code>modified_at</code> field in
a request is an ISO-8601 formatted date-time. The <em>content-type management</em> portion is responsible for translating
a binary <code>msgpack</code> message into a Python <code>dict</code> containing primitive types.</p>
<h2 id="consequences">Consequences<a class="headerlink" href="#consequences" title="Permanent link">&para;</a></h2>
<p>This approach places a large emphasis on type annotation processing of user-supplied functions. Interpreting the
annotations on a function is pretty messy today ... even in Python 3.12. There are several different ways to retrieve
type information from an annotated function and they differ slightly. This will make the implementation interesting
and, perhaps, even brittle. The universe of typing-related PEPs is also a moving target. I'm betting on it being more
well-behaved than the JSON schema tooling and OpenAPI specifications.</p>
<h2 id="rejected-alternatives">Rejected alternatives<a class="headerlink" href="#rejected-alternatives" title="Permanent link">&para;</a></h2>
<h3 id="parsing-docstrings">Parsing docstrings<a class="headerlink" href="#parsing-docstrings" title="Permanent link">&para;</a></h3>
<p>The ability to parse information from structured docstrings using a well-known format (eg, sphinx) is one way to
figure out what a request handler method expects. I didn't like this option since it either tied me to one docstring
format or left me writing different parsers and coming up with an intermediate format. The intermediate format ends
up looking a lot like type annotations or an OpenAPI specification.</p>
<h3 id="tying-an-openapi-specification-to-endpoints">Tying an OpenAPI specification to endpoints<a class="headerlink" href="#tying-an-openapi-specification-to-endpoints" title="Permanent link">&para;</a></h3>
<p>Another option is to describe the endpoints in an OpenAPI specification and use the embedded JSON schema descriptions
to validate requests and process responses. This approach is possible and would work relatively well if it weren't for
one glaring problem -- JSON schema descriptions do not easily map to the Python type system... <em>and I am aware that
one of the goals of this library is to generate OpenAPI</em>. This problem can be worked around by coming up with a mapping
definition from arbitrary JSON schema to Python instances in the most recent OpenAPI specification (3.1.0).</p>
<p>I ultimately stepped away from this approach for a few reasons that are important to understand:</p>
<ol>
<li>OpenAPI is an ever-changing specification. The 3.0 version used JSON schema for <em>most</em> things but not everything.
This was rectified in 3.1 at the expense of having to rewrite the usage of <code>nullable</code> in your specification. The next
revision looks to be a drastic simplification which will again require rewriting your specification. Maybe after the
specifications normalize this can be made to work.</li>
<li>JSON schema definitions and the Python type system don't see eye-to-eye. This is another thing that is slowly
improving through revisions of JSON schema itself. Yes, it is a moving target as well. Consider the difference between
lists and tuples. Python lists are meant to be extended with new values. Tuples, however, tend to have a fixed and
known length. Describing a tuple containing an integer and two strings in JSON schema is a little more difficult than
you might expect.</li>
<li>Engineers are not great at writing <strong>precise</strong> OpenAPI descriptions. It is a little easier to write precise type
annotations since they are at least still Python and good tooling exists for checking your annotations.</li>
<li>An OpenAPI specification and the Python type system are different and <em>they should be</em>. This is more of a idealogical
argument. I truly believe that writing an OpenAPI specification that <em>describes</em> the API and its intended usage should
concentrate on making the specification useful for documentation and machine-readable validation. Letting Python type
system details or implementation details leak into the specification muddies it plain and simple.</li>
</ol>





                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../0002-generate-documentation-using-mkdocs/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Generate documentation using mkdocs">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Generate documentation using mkdocs
              </div>
            </div>
          </a>
        
        
          
          <a href="../../todo/" class="md-footer__link md-footer__link--next" aria-label="Next: TODO">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                TODO
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.indexes", "navigation.instant", "navigation.tabs", "search.suggest"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>